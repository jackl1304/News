{% extends "base.html" %}

{% block title %}Medizintechnik Newsletter - Anmeldung{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- Hero Section -->
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold text-primary mb-3">
                <i class="fas fa-heartbeat me-3"></i>
                Medizintechnik Newsletter
            </h1>
            <p class="lead text-muted">
                Bleiben Sie automatisch über wichtige Änderungen in Normen, Gesetzen und Regulierungen 
                im Bereich Medizintechnik und Healthcare informiert.
            </p>
        </div>

        <!-- Features -->
        <div class="row mb-5">
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="feature-icon bg-primary text-white rounded-circle mx-auto mb-3">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h5 class="card-title">KI-basierte Überwachung</h5>
                        <p class="card-text text-muted">
                            Unser intelligentes System überwacht kontinuierlich offizielle Quellen 
                            und erkennt automatisch relevante Änderungen.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="feature-icon bg-success text-white rounded-circle mx-auto mb-3">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h5 class="card-title">Vertrauenswürdige Quellen</h5>
                        <p class="card-text text-muted">
                            Informationen stammen ausschließlich von autorisierten Stellen 
                            wie FDA, BfArM, ISO und TÜV.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="feature-icon bg-info text-white rounded-circle mx-auto mb-3">
                            <i class="fas fa-user-cog"></i>
                        </div>
                        <h5 class="card-title">Personalisierte Inhalte</h5>
                        <p class="card-text text-muted">
                            Erhalten Sie nur die für Sie relevanten Informationen 
                            basierend auf Ihren Interessensgebieten.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="feature-icon bg-warning text-white rounded-circle mx-auto mb-3">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h5 class="card-title">Zeitnahe Benachrichtigung</h5>
                        <p class="card-text text-muted">
                            Erhalten Sie wichtige Änderungen schnell und zuverlässig 
                            per E-Mail-Newsletter.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subscription Form -->
        <div class="card shadow-lg border-0">
            <div class="card-header bg-primary text-white text-center py-4">
                <h3 class="mb-0">
                    <i class="fas fa-envelope me-2"></i>
                    Jetzt anmelden
                </h3>
                <p class="mb-0 mt-2 opacity-75">
                    Kostenlos und jederzeit kündbar
                </p>
            </div>
            <div class="card-body p-4">
                <form id="subscriptionForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope me-1"></i>
                                E-Mail-Adresse *
                            </label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">
                                <i class="fas fa-user me-1"></i>
                                Name
                            </label>
                            <input type="text" class="form-control" id="name" name="name">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="company" class="form-label">
                            <i class="fas fa-building me-1"></i>
                            Unternehmen
                        </label>
                        <input type="text" class="form-control" id="company" name="company">
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-tags me-1"></i>
                            Interessensgebiete (optional)
                        </label>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Medical Device Regulation" id="interest1">
                                    <label class="form-check-label" for="interest1">
                                        Medical Device Regulation (MDR)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="In Vitro Diagnostic" id="interest2">
                                    <label class="form-check-label" for="interest2">
                                        In Vitro Diagnostic (IVD)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Quality Management" id="interest3">
                                    <label class="form-check-label" for="interest3">
                                        Quality Management
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Risk Management" id="interest4">
                                    <label class="form-check-label" for="interest4">
                                        Risk Management
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Clinical Evaluation" id="interest5">
                                    <label class="form-check-label" for="interest5">
                                        Clinical Evaluation
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Biocompatibility" id="interest6">
                                    <label class="form-check-label" for="interest6">
                                        Biocompatibility
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Software" id="interest7">
                                    <label class="form-check-label" for="interest7">
                                        Medical Device Software
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Sterilization" id="interest8">
                                    <label class="form-check-label" for="interest8">
                                        Sterilization
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-paper-plane me-2"></i>
                            Jetzt anmelden
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Info Section -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="alert alert-info border-0">
                    <div class="row align-items-center">
                        <div class="col-md-2 text-center">
                            <i class="fas fa-info-circle fa-3x text-info"></i>
                        </div>
                        <div class="col-md-10">
                            <h5 class="alert-heading">Wie funktioniert es?</h5>
                            <p class="mb-0">
                                Unser KI-System überwacht kontinuierlich die Websites von FDA, BfArM, ISO, TÜV und anderen 
                                autorisierten Quellen. Bei erkannten Änderungen in Normen, Gesetzen oder Regulierungen 
                                erhalten Sie automatisch einen personalisierten Newsletter mit den wichtigsten Informationen. 
                                Sie erhalten nur dann eine E-Mail, wenn tatsächlich relevante Änderungen vorliegen.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-check-circle me-2"></i>
                    Anmeldung erfolgreich!
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Vielen Dank für Ihre Anmeldung! Sie erhalten in Kürze eine Bestätigungs-E-Mail.</p>
                <p class="mb-0">Sie werden ab sofort über wichtige Änderungen in der Medizintechnik-Regulierung informiert.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Verstanden</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('subscriptionForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    // Sammle Interessensgebiete
    const interests = [];
    document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
        interests.push(checkbox.value);
    });
    
    const data = {
        email: formData.get('email'),
        name: formData.get('name'),
        company: formData.get('company'),
        interests: interests
    };
    
    // Button deaktivieren
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Wird verarbeitet...';
    
    try {
        const response = await fetch('/subscribe', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            // Erfolg
            const modal = new bootstrap.Modal(document.getElementById('successModal'));
            modal.show();
            this.reset();
        } else {
            // Fehler
            alert('Fehler: ' + result.error);
        }
    } catch (error) {
        alert('Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.');
    } finally {
        // Button wieder aktivieren
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
});
</script>
{% endblock %}

