{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2">Admin Dashboard</h1>
    <div class="btn-group">
        <button type="button" class="btn btn-primary" onclick="manualScraping()">Manuelles Scraping</button>
        <button type="button" class="btn btn-success" onclick="manualNewsletter()">Newsletter generieren</button>
    </div>
</div>

<div class="row mb-4">
    </div>

<div class="card mt-4 shadow-sm">
    <div class="card-header">
        Benutzerverwaltung
    </div>
    <div class="card-body">
        <button class="btn btn-primary" onclick="loadUsers()">Benutzerliste anzeigen</button>
        <div id="user-list-container" class="mt-3 table-responsive"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function manualScraping() {
        alert('Starte manuelles Scraping... (Diese Funktion ist noch in Entwicklung)');
        // Hier folgt die Fetch-Logik
    }
    async function manualNewsletter() {
        alert('Starte Newsletter-Generierung... (Diese Funktion ist noch in Entwicklung)');
    }

    async function deleteUser(userId) {
        if (!confirm(`Benutzer mit ID ${userId} wirklich löschen?`)) return;
        
        const response = await fetch(`/admin/user/delete/${userId}`, { method: 'POST' });
        const result = await response.json();
        alert(result.message || result.error);
        loadUsers();
    }

    function editUser(userId) {
        window.location.href = `/admin/user/edit/${userId}`;
    }

    async function loadUsers() {
        const container = document.getElementById('user-list-container');
        container.innerHTML = '<div class="spinner-border spinner-border-sm"></div>';
        
        const response = await fetch('/admin/users');
        const users = await response.json();
        
        let table = `<table class="table table-striped">
            <thead><tr><th>ID</th><th>E-Mail</th><th>Admin</th><th>Aktionen</th></tr></thead>
            <tbody>`;
        
        users.forEach(user => {
            table += `<tr>
                <td>${user.id}</td>
                <td>${user.email}</td>
                <td>${user.is_admin ? 'Ja' : 'Nein'}</td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="editUser(${user.id})">Bearbeiten</button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteUser(${user.id})">Löschen</button>
                </td>
            </tr>`;
        });
        
        table += `</tbody></table>`;
        container.innerHTML = table;
    }
</script>
{% endblock %}
