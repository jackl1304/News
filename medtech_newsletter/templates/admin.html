{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="card mt-4">
    <div class="card-header">
        Benutzerverwaltung
    </div>
    <div class="card-body">
        <button class="btn btn-primary" onclick="loadUsers()">Benutzer laden</button>
        <div id="user-list" class="mt-3"></div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    async function deleteUser(userId) {
        if (!confirm(`Möchten Sie den Benutzer mit der ID ${userId} wirklich löschen?`)) {
            return;
        }
        const response = await fetch(`/admin/user/delete/${userId}`, {
            method: 'POST',
        });
        const result = await response.json();
        alert(result.message || result.error);
        loadUsers(); // Liste neu laden
    }

    async function loadUsers() {
        const response = await fetch('/admin/users');
        const users = await response.json();
        const userListDiv = document.getElementById('user-list');
        
        let tableHtml = `<table class="table"><thead><tr><th>ID</th><th>E-Mail</th><th>Admin</th><th>Aktionen</th></tr></thead><tbody>`;
        users.forEach(user => {
            tableHtml += `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.email}</td>
                    <td>${user.is_admin ? 'Ja' : 'Nein'}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Löschen</button>
                    </td>
                </tr>
            `;
        });
        tableHtml += `</tbody></table>`;
        userListDiv.innerHTML = tableHtml;
    }
</script>
{% endblock %}
